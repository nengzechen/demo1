# Postman 测试用例使用说明

## 简介

本文档说明如何导入和使用Postman测试用例集合来测试用户权限管理系统API。

## 导入步骤

### 1. 导入Collection

1. 打开Postman应用
2. 点击左上角的 `Import` 按钮
3. 选择 `File` 标签
4. 点击 `Choose Files` 并选择 `Postman测试用例.json` 文件
5. 点击 `Import` 完成导入

### 2. 配置环境变量

导入后，Collection中已经包含了一个默认的环境变量 `baseUrl`：

- **变量名**: `baseUrl`
- **默认值**: `http://localhost:8080`

如果你的服务运行在不同的地址或端口，可以在Postman中修改这个变量：

1. 点击右上角的齿轮图标 ⚙️
2. 点击 `Add` 创建新环境
3. 添加变量 `baseUrl`，值为你的服务地址
4. 保存并选择该环境

## 测试用例结构

测试集合分为三个主要模块：

### 1. 用户管理（10个测试用例）

- 创建用户
- 创建用户-参数验证失败
- 获取用户详情
- 获取用户列表
- 搜索用户
- 根据用户名获取用户
- 根据状态查询用户
- 更新用户
- 删除用户
- 批量删除用户

### 2. 角色管理（10个测试用例）

- 创建角色
- 创建角色-编码格式错误
- 获取角色详情
- 获取角色列表
- 搜索角色
- 根据编码获取角色
- 根据状态查询角色
- 更新角色
- 删除角色
- 批量删除角色

### 3. 权限管理（11个测试用例）

- 创建权限
- 创建权限-操作类型错误
- 获取权限详情
- 获取权限列表
- 搜索权限
- 根据编码获取权限
- 根据资源查询权限
- 根据状态查询权限
- 更新权限
- 删除权限
- 批量删除权限

## 执行测试

### 执行单个测试

1. 在左侧Collection列表中选择要执行的测试用例
2. 点击右侧的 `Send` 按钮
3. 查看响应结果

### 执行整个Collection

1. 点击Collection名称旁的 `...` 按钮
2. 选择 `Run collection`
3. 在Runner界面中配置执行选项
4. 点击 `Run 用户权限管理系统API` 按钮
5. 查看测试结果

### 建议的测试顺序

为了获得最佳测试效果，建议按以下顺序执行测试：

#### 第一轮：创建测试数据

1. **权限管理** → 创建权限
   - 创建多个不同的权限（USER:READ, USER:CREATE, USER:UPDATE, USER:DELETE等）
   
2. **角色管理** → 创建角色
   - 创建管理员角色（ADMIN）
   - 创建普通用户角色（USER）
   
3. **用户管理** → 创建用户
   - 创建测试用户，分配角色

#### 第二轮：查询测试

4. 执行各个模块的"获取列表"和"搜索"功能
5. 验证分页和排序功能

#### 第三轮：更新和删除测试

6. 执行更新操作
7. 执行删除操作

#### 第四轮：异常场景测试

8. 执行参数验证失败的测试用例
9. 测试重复创建（已存在的数据）
10. 测试查询不存在的资源

## 测试场景说明

### 正常场景测试

测试用例名称不包含特殊标记的为正常场景测试：

```
创建用户
获取用户详情
更新用户
...
```

期望结果：HTTP 200，操作成功

### 异常场景测试

测试用例名称包含"-"后缀的为异常场景测试：

```
创建用户-参数验证失败
创建角色-编码格式错误
创建权限-操作类型错误
```

期望结果：HTTP 400/409，返回错误信息

## 响应验证

### 成功响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2026-01-22T10:30:00"
}
```

### 错误响应格式

```json
{
  "code": 400,
  "message": "参数验证失败",
  "data": {
    "username": "用户名长度必须在3-50之间"
  },
  "timestamp": "2026-01-22T10:30:00"
}
```

## 常见问题

### Q1: 连接失败

**问题**: 发送请求时提示连接失败

**解决方案**:
1. 确认服务是否已启动
2. 检查 `baseUrl` 配置是否正确
3. 确认端口是否被占用
4. 检查防火墙设置

### Q2: 404错误

**问题**: 请求返回404 Not Found

**解决方案**:
1. 检查请求路径是否正确
2. 确认API端点是否已实现
3. 查看服务日志

### Q3: 参数验证失败

**问题**: 创建/更新操作返回400错误

**解决方案**:
1. 检查请求参数格式是否正确
2. 确认必填字段是否都已提供
3. 验证字段值是否符合规则

### Q4: 资源已存在

**问题**: 创建操作返回409错误

**解决方案**:
1. 使用不同的用户名/邮箱/编码
2. 先删除已存在的资源再创建
3. 或使用更新操作代替创建

## 高级功能

### 添加自动化测试脚本

你可以在Postman的 `Tests` 标签中添加测试脚本，例如：

```javascript
// 验证响应状态码
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

// 验证响应格式
pm.test("Response has correct structure", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('code');
    pm.expect(jsonData).to.have.property('message');
    pm.expect(jsonData).to.have.property('data');
});

// 保存响应数据到环境变量
var jsonData = pm.response.json();
if (jsonData.data && jsonData.data.id) {
    pm.environment.set("userId", jsonData.data.id);
}
```

### 使用环境变量链接测试

可以使用环境变量来存储创建的资源ID，在后续测试中使用：

1. 在"创建用户"的 Tests 中保存用户ID：
```javascript
pm.environment.set("createdUserId", pm.response.json().data.id);
```

2. 在"获取用户详情"中使用该ID：
```
{{baseUrl}}/api/users/{{createdUserId}}
```

## 测试报告

执行Collection Runner后，Postman会生成详细的测试报告，包括：

- 总执行时间
- 成功/失败的测试数量
- 每个请求的响应时间
- 详细的错误信息

你可以导出测试报告以供团队查看或存档。

## 支持与反馈

如有问题或建议，请联系开发团队。

---

**文档版本**: v1.0.0  
**最后更新**: 2026-01-22
